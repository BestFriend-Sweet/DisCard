<!DOCTYPE html>
<html>
  <head>
    <title>Add Map</title>

    <style type="text/css">
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        /* The height is 400 pixels */
        width: 100%;
        /* The width is the width of the web page */
      }
    </style>
    <script>
      var placesService;
      function placeLoggerCallback(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            console.log(results[i]);
          }
        }
      }
      // Initialize and add the map
      function initMap(position) {
        const pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 20,
          center: pos,
        });
        const marker = new google.maps.Marker({
          position: pos,
          map: map,
        });

        placesService = new google.maps.places.PlacesService(map);
        var placeRequest = {
          location: pos,
          radius: 5,
          type: ''
        };
        function placeSearchCallback(results, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
            let result;
            console.log(results);
            for (var i = 0; i < results.length; i++) {
              // if(results[i].types.includes("political") || results[i].types.includes("locality"))
              //   continue;
              if(results[i].types.includes("establishment")) {
                result = results[i];
                break;
              }
            }
            document.getElementById("place_info").innerHTML = `<img src="${result.icon}"><p>Name: ${result.name}<br>Type: ${result.types[0]} (all types: ${result.types})</p>`;
          }
        }
        placesService.nearbySearch(placeRequest, placeSearchCallback);
      }
      function locateUser() {
        function error() {
          alert('Unable to retrieve your location, please accept the request');
          location.reload();
        }
        /*
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(initMap, error);
        } else {
          alert("Geolocation unsupported!");
        }
        */
        // HACK: Hardcode location for dev
        // Food Basics 43.813331597239305, -79.35717205097839
        // Wimpy's 43.812764306439185, -79.35876756564207
        // Walmart 43.84206667911532, -79.4180689844961
        initMap({coords:{latitude: 43.813331597239305, longitude: -79.35717205097839}});
      }
    </script>
  </head>
  <body>
    <h3>My Google Maps Demo</h3>
    <!--The div element for the map -->
    <div id="map"></div>
    <div id="place_info"></div>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbuW6io6kSXL0HzNwwLs42Da03rxIO70A&callback=locateUser&libraries=places&v=weekly"
      async
    ></script>
  </body>
</html>
