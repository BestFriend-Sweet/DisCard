<!DOCTYPE html>
<html>
<head>

  <!--Bootstrap?-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders+Stencil+Display:wght@300&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/cashbacksearch.css">

</head>
<body>
  <div class="container-fluid">
    <h1>discard</h1>
    
    <div class="search-label">
      <p class = "heading">Explore cashback rewards for thousands of stores</p>
    </div>
    <form class="input-group" onSubmit="return false;">
      <input class="search-bar" type="text" name="userInput" id="userInput" placeholder="Search for cashback opportunities" onkeyup="search()" required>
      <button class="btn btn-primary" type="submit" onClick="handle(userInput)"><i class="bi bi-search"></i></button>
    </form>
    <p id="result"></p>

    <ul id = "myUL">
      
    </ul>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>

      function handle(userInput) {
        alert(document.getElementById('userInput').value);      
        var result = document.getElementById('userInput').value;
      }
      function search(){
        

        var input, filter, ul, li, a, i, txtValue;
        input = document.getElementById('userInput');
        filter = input.value.toUpperCase();
        //change this to using the json
        
        
        


        //for(i = 0; i < li.length; i++){
          //a = li[i].getElementsByTagName("a")[0]; 
          //!!! Object.keys(storeList).length FOR ARRAY LENGTH
        
          let temp;
          let boxNumber = 0;
          $.getJSON("../resource/rakuten.json", function(json){
            const storeList = json["stores"];
            for(i = 0; i < Object.keys(storeList).length; i++){
              txtValue = storeList[Object.keys(storeList)[i]];
              temp = txtValue['name']; 

              //IF temp matches the 'i'th value in storeList, create a li tag and place it inside

              if (temp.toUpperCase().indexOf(filter) > -1){
                let deleteLi = document.querySelectorAll('li');

                //ul = document.getElementById('myUL');
                for (list in deleteLi){//okay that's wrong
                  document.getElementById('myUL').removeChild(list)
                }
                
                const li = document.createElement('li');

                li.innerHTML = `<a href = "#" id = "listItem">` + temp + `</a>`;

                document.getElementById('myUL').appendChild(li)

                //document.getElementById(boxNumber.toString()).innerHTML = temp;
                //boxNumber++;
              } 
            }
            
          });
          /* FOR REFERENCE FROM BEFORE - WITHOUT ADDING FUNCTION
          $.getJSON("../scrape/rakuten/rakuten.json", function(json){
            const storeList = json["stores"];
            for(i = 0; i < 5; i++){
              txtValue = storeList[Object.keys(storeList)[i]];
              temp = txtValue['name']; 
              console.log(temp);

              if (temp.toUpperCase().indexOf(filter) > -1){
                document.getElementById(boxNumber.toString()).innerHTML = temp;
                boxNumber++;
              } 
            }
            while(boxNumber < 5){//5 should be replaced with the number of loops/boxes
              let toHide = document.querySelector("#" + boxNumber.toString());
              toHide.style.visibility = "hidden";
              
              document.getElementById(boxNumber.toString()).innerHTML = "blank";
              boxNumber++;
              
            }
          });*/


          //how to make extra html tags based on javascript?


          //txtValue = a.textContent || a.innerText;
          
          /*if (txtValue.toUpperCase().indexOf(filter) > -1){
            document.getElementById(i.toString()).innerHTML = storeList[Object.keys(storeList)[i]]
            //li[i].style.display = ""; //change displaying the store name + link
          } else {
            li[i].style.display = 'none';
          }*/
        }
      
    </script>
  </div>
</body>
</html>
